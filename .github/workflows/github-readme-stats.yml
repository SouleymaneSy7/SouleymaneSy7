name: Update README Cards

on:
  schedule:
    - cron: "0 */6 * * *" # Every 6 hours
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    permissions:
      contents: write

    steps:
      - uses: actions/checkout@v4

      # ============================================
      # GITHUB README STATS CARDS
      # ============================================

      - name: Generate Stats Card
        uses: readme-tools/github-readme-stats-action@v1
        with:
          card: stats
          options: username=${{ github.repository_owner }}&show_icons=true&theme=nord&hide_border=true&include_all_commits=true&count_private=true
          path: profile/stats.svg
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Generate Top Languages Card
        uses: readme-tools/github-readme-stats-action@v1
        with:
          card: top-langs
          options: username=${{ github.repository_owner }}&theme=nord&card_width=500&langs_count=6&hide_border=true
          path: profile/top-langs.svg
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Generate Trophy Card
        uses: soulteary/github-profile-trophy-action@v1.0.0
        with:
          options: "username=${{ github.repository_owner }}&theme=nord&margin-w=6&margin-h=6&row=2&column=3&no-frame=true"
          path: profile/trophy.svg
          token: ${{ secrets.GITHUB_TOKEN }}

      # ============================================
      # PIN CARDS FOR FEATURED PROJECTS
      # ============================================

      - name: Generate Pin - Fyrre Magazine
        uses: readme-tools/github-readme-stats-action@v1
        with:
          card: pin
          options: username=${{ github.repository_owner }}&repo=fyrre-magazine-website&theme=nord&hide_border=true
          path: profile/pin-fyrre-magazine-website.svg
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Generate Pin - Terminal Portfolio
        uses: readme-tools/github-readme-stats-action@v1
        with:
          card: pin
          options: username=${{ github.repository_owner }}&repo=terminal-portfolio-website&theme=nord&hide_border=true
          path: profile/pin-terminal-portfolio-website.svg
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Generate Pin - Conakry Website Challenge
        uses: readme-tools/github-readme-stats-action@v1
        with:
          card: pin
          options: username=${{ github.repository_owner }}&repo=conakry-website-challenge&theme=nord&hide_border=true
          path: profile/pin-conakry-website-challenge.svg
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Generate Pin - Dictionary App
        uses: readme-tools/github-readme-stats-action@v1
        with:
          card: pin
          options: username=${{ github.repository_owner }}&repo=dictionary-web-app&theme=nord&hide_border=true
          path: profile/pin-dictionary-web-app.svg
          token: ${{ secrets.GITHUB_TOKEN }}

      # ============================================
      # STREAK STATS (CURL - LOCAL STORAGE) ðŸ”¥
      # ============================================

      - name: Download Streak Stats SVG
        run: |
          curl -o profile/streak-stats.svg \
          "https://streak-stats.demolab.com?user=${{ github.repository_owner }}&theme=nord&hide_border=true&border_radius=6&date_format=M%20j%5B%2C%20Y%5D&mode=weekly&fire=DD2727&ring=5DBCD2&currStreakLabel=D8DEE9"

      # Verify if the streak stats files is created
      - name: Verify Streak Stats
        run: |
          if [ ! -s profile/streak-stats.svg ]; then
            echo "Error: Streak stats file is empty or missing"
            exit 1
          fi
          echo "Streak stats downloaded successfully"

      # ============================================
      # ACTIVITY GRAPH
      # ============================================

      - name: Download Activity Graph
        run: |
          curl -o profile/activity-graph.svg \
          "https://github-readme-activity-graph.vercel.app/graph?username=${{ github.repository_owner }}&theme=nord&custom_title=Souleymane%27s%20Contribution%20Graph&hide_border=true&radius=5"

      # Verify if the activity graph files is created
      - name: Verify Activity Graph
        run: |
          if [ ! -s profile/activity-graph.svg ]; then
            echo "Error: Activity Graph file is empty or missing"
            exit 1
          fi
          echo "Activity Graph downloaded successfully"

      # ============================================
      # DEV QUOTE
      # ============================================

      - name: Download Dev Quote
        run: |
          curl -o profile/dev-quote.svg \
          "https://quotes-github-readme.vercel.app/api?type=horizontal&theme=nord&border=true"

      # Verify if the dev quote files is created
      - name: Verify Dev Quote
        run: |
          if [ ! -s profile/dev-quote.svg ]; then
            echo "Error: Dev Quote file is empty or missing"
            exit 1
          fi
          echo "Dev Quote downloaded successfully"

      # ============================================
      # COMMIT ALL FILES
      # ============================================

      - name: Commit All Cards
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add profile/*.svg
          git diff --quiet && git diff --staged --quiet || git commit -m "docs: update readme stats cards ðŸ“Š [skip ci]"
          git push
